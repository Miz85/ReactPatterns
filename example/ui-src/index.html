<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>ReactPatterns-example</title>

		<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/base-min.css">
		<link rel="stylesheet" href="app.min.css"/>

	</head>
	<body class="bodyStyle main">

		<header class="header" >
			<span class="Title">ReactPatterns-example by Janaka</span>
			<p>This page is an example of the drag and drop pattern.</p>
		</header>

		<section id="react" class="content"></section>

		<p>This code is the dnd.ctrl.js which sets up the dnd.list.js that follows.</p>
		<div class="codeSty">
		<pre><code>
			import React, {Component} from 'react';
			import _ld from 'lodash';

			import DList from './dnd.list';

			var DndCtrlSty = {
				padding: '0 10px 0 30px'
			}

			var list = [
				{id: 'l1', label: 'first line of list'},
				{id: 'l2', label: 'second line of list'},
				{id: 'l3', label: 'third line of list'},
				{id: 'l4', label: 'fourth line of list'},
				{id: 'l5', label: 'fifth line of list'},
				{id: 'l6', label: 'sixth line of list'}
			]

			class DndCtrlRender extends Component {
				binder(...methods) { methods.forEach( (method) => this[method] = this[method].bind(this) ); }

				render() {
					return (
						&lt;div id='DndCtrlSty' className='FlexBox' style={DndCtrlSty}>
							&lt;DList data={list} />
							&lt;DList data={this.state.list} dndDone={this.dndDone} />
						&lt;/div>
					);
				}
			}

			export default class DndCtrl extends DndCtrlRender {
				constructor() {
				  super();
					this.state = {list: _ld.cloneDeep(list)};
					this.binder('dndDone');
				}
				dndDone(startID, endID) {
					var newList = this.state.list;
					var startObj = _ld.findWhere(newList, {id: startID});
					var startIndex = _ld.indexOf(newList, startObj);
					newList.splice(startIndex, 1);
					var endObj = _ld.findWhere(newList, {id: endID});
					var endIndex = _ld.indexOf(newList, endObj) + 1;
					newList.splice(endIndex, 0, startObj);
					this.setState.list = newList;
				}
			}
		</code></pre>
		</div>
		<p>This code is from dnd.list.js.</p>
		<div class="codeSty">
		<pre><code class="codeSty">
			import React, {Component} from 'react';

			var listSty = {}
			var listStyle = {marginLeft: '50px'}

			var lineSty = {}
			var lineStyle = {
				color: '#FBF7C3',
				marginLeft: '7px'
			}
			var startLineStyle = {
				color: '#1F1',
				marginLeft: '7px'
			}
			var overLineStyle = {
				color: '#F11',
				marginLeft: '7px'
			}
			var endLineStyle = {
				color: '#11F',
				marginLeft: '7px'
			}

			function divColorMap(item) {
				if (this.state.startID === item.id) lineSty = startLineStyle;
				else if (this.state.overID === item.id) lineSty = overLineStyle;
				else if (this.state.endID === item.id) lineSty = endLineStyle;
				else lineSty = lineStyle;
				return (
					&lt;div
						style={lineSty}
						id={item.id}
						key={item.id}
						draggable="true"
						onDragStart={this.onThisDragStart}
						onDragOver={this.onThisDragOver}
						onDrop={this.onThisDragEnd}>
						{item.label}
					&lt;/div>
				)
			}

			function divMap(item) {
				lineSty = lineStyle;
				return (
					&lt;div
						style={lineSty}
						id={item.id}
						key={item.id}
						draggable="true"
						onDragStart={this.onThisDragStart}
						onDragOver={this.onThisDragOver}
						onDrop={this.onThisDragEnd}>
						{item.label}
					&lt;/div>
				)
			}

			class DndListRender extends Component {
				binder(...methods) { methods.forEach( (method) => this[method] = this[method].bind(this) ); }

				render() {
					listSty = listStyle;
					var vm = this;
					var list;
					if (this.props.dndDone) list = this.props.data.map(divMap, vm);
					else list = this.props.data.map(divColorMap, vm);
					return (
						&lt;div id='DndListSty' style={listSty}>
							{list}
						&lt;/div>
					);
				}
			}

			export default class DndList extends DndListRender {
				constructor() {
				  super();
					this.state = {
						startID: '',
						overID: '',
						endID: ''
					};
					this.binder('onThisDragStart', 'onThisDragOver', 'onThisDragEnd');
				}
				onThisDragStart(event) {
					var itemID = event.target.id;
					if (itemID) { this.setState({startID: itemID, overID: '', endID: ''}) };
				}
				onThisDragOver(event) {
					var itemID = event.target.id;
					if (itemID) { this.setState({overID: itemID}) };
					event.preventDefault();
				}
				onThisDragEnd(event) {
					var itemID = event.target.id;
					if (itemID) { this.setState({endID: itemID, overID: ''}) };
					if (this.props.dndDone) this.props.dndDone(this.state.startID, itemID);
				}
			}
		</code></pre>
		</div>

		<script src="app.min.js"></script>

	</body>
</html>
